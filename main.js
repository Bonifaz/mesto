(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var t=function(){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._validationSettings=e,this._form=n}var n,r;return n=t,(r=[{key:"enableValidation",value:function(){this._form.addEventListener("submit",(function(e){e.preventDefault()})),this._setAddEventListeners(this._inputs())}},{key:"_inputs",value:function(){return Array.from(this._form.querySelectorAll(this._validationSettings.inputSelector))}},{key:"_allInputsValid",value:function(e){return!e.some((function(e){return!e.validity.valid}))}},{key:"_setAddEventListeners",value:function(e){var t=this;e.forEach((function(n){n.addEventListener("input",(function(){return t._validForms(e,n)}))}))}},{key:"_validForms",value:function(e,t){var n=this._allInputsValid(e);this.toggleClassSubmitButton(n),t.validity.valid?this._hideInputError(t):this._showInputError(t)}},{key:"_hideInputError",value:function(e){e.classList.remove(this._validationSettings.inputErrorClass);var t=this._form.querySelector("#".concat(e.id,"-error"));t.classList.remove(this._validationSettings.errorClass),t.textContent=""}},{key:"hideAllInputsError",value:function(){var e=this;this._inputs().forEach((function(t){e._hideInputError(t)}))}},{key:"_showInputError",value:function(e){e.classList.add(this._validationSettings.inputErrorClass);var t=this._form.querySelector("#".concat(e.id,"-error"));t.textContent=e.validationMessage,t.classList.add(this._validationSettings.errorClass)}},{key:"toggleClassSubmitButton",value:function(e){var t=this._form.querySelector(this._validationSettings.submitButtonSelector);e?(t.classList.remove(this._validationSettings.inactiveButtonClass),t.removeAttribute("disabled","disabled")):(t.classList.add(this._validationSettings.inactiveButtonClass),t.setAttribute("disabled","disabled"))}}])&&e(n.prototype,r),t}();function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var r=function(){function e(t,n,r,o,i,a,c,u,s,l){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._item=t,this._templateSelector=n,this.openImageHandler=o,this.openDeleteHandler=i,this._templateCopy=this._getTemplate(),this._countLike=r,this._imageCard=this._templateCopy.querySelector(".element__image"),this._titleCard=this._templateCopy.querySelector(".element__title"),this._counterLike=this._templateCopy.querySelector(".element__counter"),this._buttonDeleteCard=this._templateCopy.querySelector(".element__delete"),this._buttonHeart=this._templateCopy.querySelector(".element__heart"),this._setLike=a,this._deleteLike=c,this._userName=u,this._userId=s,this._cardId=l}var t,r;return t=e,(r=[{key:"_getTemplate",value:function(){return this._templateSelector.content.cloneNode(!0)}},{key:"initCard",value:function(){var e=this;return this._imageCard.src=this._item.link,this._titleCard.textContent=this._item.name,this._item.likes.forEach((function(t){t.name===e._userName&&e._buttonHeart.classList.add("element__heart_active")})),this._item.owner._id!="".concat(this._userId)&&this._buttonDeleteCard.remove(),this._counterLike.textContent=this._countLike,this._templateCopy.querySelector(".element").setAttribute("ID","".concat(this._cardId)),this._setEventListeners(),this._templateCopy}},{key:"_setEventListeners",value:function(){var e=this;this._buttonDeleteCard.addEventListener("click",(function(t){return e.openDeleteHandler(t.target)})),this._buttonHeart.addEventListener("click",(function(t){return e.buttonHeartActiveHandler(e._buttonHeart,e._counterLike,t)})),this._imageCard.addEventListener("click",(function(){return e.openImageHandler(e._item.link,e._item.name)}))}},{key:"deleteCardHandler",value:function(e){e.closest(".element").remove()}},{key:"buttonHeartActiveHandler",value:function(e,t,n){e.classList.toggle("element__heart_active");var r=n.target.closest(".element").id;e.classList.contains("element__heart_active")?(this._setLike(r),t.textContent=Number(t.textContent)+1):(this._deleteLike(r),t.textContent=Number(t.textContent)-1)}}])&&n(t.prototype,r),e}();function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(t,n){var r=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderer=r,this.elements=n}var t,n;return t=e,(n=[{key:"renderItems",value:function(e,t,n){var r=this;e.forEach((function(e){r.renderer(e,r.elements,t,n)}))}},{key:"addItem",value:function(e,t){t.prepend(e)}},{key:"deleteItem",value:function(e){e.remove()}}])&&o(t.prototype,n),e}();function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.popUpSelector=t}var t,n;return t=e,(n=[{key:"open",value:function(){var e=this;this.popUpSelector.classList.add("pop-up_open"),document.addEventListener("keydown",(function(t){return e._handleEscClose(t)}))}},{key:"close",value:function(){var e=this;this.popUpSelector.classList.remove("pop-up_open"),document.removeEventListener("keydown",(function(t){return e._handleEscClose(t)}))}},{key:"_handleEscClose",value:function(e){var t=document.querySelector(".pop-up_open");27===e.which&&this.close(t)}},{key:"setEventListeners",value:function(){var e=this;this.popUpSelector.addEventListener("click",(function(t){t.target===e.popUpSelector&&e.close()})),this.popUpSelector.querySelector(".pop-up__cross").addEventListener("click",(function(){return e.close()}))}}])&&a(t.prototype,n),e}();function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t,n){return(f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var _=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=h(r);if(o){var n=h(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return d(this,e)});function a(){return s(this,a),i.apply(this,arguments)}return t=a,(n=[{key:"open",value:function(e,t){var n=this.popUpSelector,r=n.querySelector(".pop-up__image");r.src=e,r.alt=t,n.querySelector(".pop-up__bottom-title").textContent=t,f(h(a.prototype),"open",this).call(this)}}])&&l(t.prototype,n),a}(c);function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t,n){return(m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=S(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var g=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=S(r);if(o){var n=S(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return k(this,e)});function a(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=i.call(this,e)).popupSubmitHandler=t,n._form=n.popUpSelector.querySelector(".pop-up__form"),n}return t=a,(n=[{key:"_getInputValues",value:function(){for(var e=Array.from(this.popUpSelector.querySelectorAll(".pop-up__item")),t={},n=0;n<e.length;n++)t[e[n].name]=e[n].value;return t}},{key:"setEventListeners",value:function(){var e=this;m(S(a.prototype),"setEventListeners",this).call(this),this._form.addEventListener("submit",(function(t){return e.popupSubmitHandler(t,e._getInputValues())}))}},{key:"close",value:function(){this._form.reset(),m(S(a.prototype),"close",this).call(this)}}])&&y(t.prototype,n),a}(c);function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var E=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.userInfoSelectors=t,this._userName=document.querySelector(this.userInfoSelectors.name),this._userProf=document.querySelector(this.userInfoSelectors.prof),this._userAvatar=document.querySelector(this.userInfoSelectors.avatar)}var t,n;return t=e,(n=[{key:"getUserInfo",value:function(){return{name:this._userName.textContent,prof:this._userProf.textContent,avatar:this._userAvatar.src}}},{key:"setUserInfo",value:function(e){this._userName.textContent=e.name,this._userProf.textContent=e.subtitle}},{key:"setAvatar",value:function(e){e&&(this._userAvatar.src=e)}}])&&C(t.prototype,n),e}(),w={formSelector:".pop-up__form",inputSelector:".pop-up__item",submitButtonSelector:".pop-up__button",inactiveButtonClass:"pop-up__button_disabled",inputErrorClass:"pop-up__input_type_error",errorClass:"pop-up__error_visible"};function L(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var q=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._token=t,this._cardAddress=n,this._userInfoAddress=r}var t,n;return t=e,(n=[{key:"getCard",value:function(){var e=this;return fetch("".concat(this._cardAddress),{headers:{authorization:"".concat(this._token)}}).then((function(t){return e._checkResponse(t)}))}},{key:"getInfo",value:function(){var e=this;return fetch("".concat(this._userInfoAddress),{headers:{authorization:"".concat(this._token)}}).then((function(t){return e._checkResponse(t)}))}},{key:"editingInfo",value:function(e,t){var n=this;return fetch("".concat(this._userInfoAddress),{method:"PATCH",headers:{authorization:"".concat(this._token),"Content-Type":"application/json"},body:JSON.stringify({name:"".concat(e),about:"".concat(t)})}).then((function(e){return n._checkResponse(e)}))}},{key:"editingAvatar",value:function(e){var t=this;return fetch("".concat(this._userInfoAddress,"/avatar"),{method:"PATCH",headers:{authorization:"".concat(this._token),"Content-Type":"application/json"},body:JSON.stringify({avatar:"".concat(e)})}).then((function(e){return t._checkResponse(e)}))}},{key:"postCard",value:function(e,t){var n=this;return fetch("".concat(this._cardAddress),{method:"POST",headers:{authorization:"".concat(this._token),"Content-Type":"application/json"},body:JSON.stringify({name:"".concat(e),link:"".concat(t)})}).then((function(e){return n._checkResponse(e)}))}},{key:"deleteCard",value:function(e){var t=this;return fetch("".concat(this._cardAddress,"/").concat(e),{method:"DELETE",headers:{authorization:"".concat(this._token)}}).then((function(e){return t._checkResponse(e)}))}},{key:"setLike",value:function(e){var t=this;return fetch("".concat(this._cardAddress,"/likes/").concat(e),{method:"PUT",headers:{authorization:"".concat(this._token)}}).then((function(e){return t._checkResponse(e)}))}},{key:"deleteLike",value:function(e){var t=this;return fetch("".concat(this._cardAddress,"/likes/").concat(e),{method:"DELETE",headers:{authorization:"".concat(this._token)}}).then((function(e){return t._checkResponse(e)}))}},{key:"_checkResponse",value:function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}}])&&L(t.prototype,n),e}();function I(e){e.textContent.indexOf("...")>0?e.textContent=e.textContent.slice(0,-3):e.textContent=e.textContent+"..."}var O=document.querySelector(".profile__edit-button"),A=document.querySelector(".pop-up_edit"),P=document.querySelector(".pop-up_delete"),j=document.querySelector(".pop-up__button_edit"),R=(document.querySelector(".pop-up__button_edit"),document.querySelector(".pop-up__button_add")),x=document.querySelector(".pop-up_avatar"),T=document.querySelector(".pop-up__form_edit"),D=document.querySelector(".pop-up__form_avatar"),H=(document.querySelectorAll(".pop-up"),document.querySelector("#template")),U=document.querySelector(".elements"),N=document.querySelector(".pop-up_add"),B=document.querySelector(".profile__button"),z=document.querySelector(".pop-up__button_avatar"),V=document.querySelector(".pop-up__form_add"),J=document.querySelector(".pop-up_modal-image"),F=".profile__avatar",M=(document.querySelector(F),document.querySelector(".pop-up__item_name")),G=document.querySelector(".pop-up__item_subtitle"),K=(document.querySelector(".pop-up__item-place"),document.querySelector(".pop-up__item-link"),document.querySelector(".pop-up__button_delete")),Q=document.querySelector(".profile__avatar-elements"),W={name:".profile__info-title",prof:".profile__info-subtitle",avatar:F},X=new q("b38e7e87-f50b-4971-8f98-b921d67a88e2","https://mesto.nomoreparties.co/v1/cohort-19/cards","https://mesto.nomoreparties.co/v1/cohort-19/users/me"),Y=new t(w,T);Y.enableValidation();var Z=new t(w,V);Z.enableValidation(),new t(w,D).enableValidation();var $=new c(P);$.setEventListeners();var ee=new g(A,(function(e,t){e.preventDefault(),I(j),X.editingInfo(t.name,t.subtitle).then((function(e){oe.setUserInfo(t),ee.close()})).catch((function(e){console.log(e)})).finally((function(){I(j)}))}));ee.setEventListeners();var te=new g(N,(function(e,t){e.preventDefault(),I(R);var n={};n.name=t.place,n.link=t.link,X.postCard(n.name,n.link).then((function(e){var t=se(e,H,e.likes.length,e.owner.name,e.owner._id,e._id);ie.addItem(t,U),te.close()})).catch((function(e){console.log(e)})).finally((function(){I(R),R.classList.add(w.inactiveButtonClass),R.setAttribute("disabled","disabled")}))}));te.setEventListeners();var ne=new _(J);ne.setEventListeners();var re=new g(x,(function(e,t){I(z),X.editingAvatar("".concat(t.linkAvatar)).then((function(e){oe.setAvatar(t.linkAvatar),re.close()})).catch((function(e){console.log(e)})).finally((function(){I(z)}))}));re.setEventListeners();var oe=new E(W),ie=new i({renderer:function(e,t,n,r){var o=se(e,H,e.likes.length,n,r,e._id);t.append(o)}},U);function ae(e){X.setLike(e).catch((function(e){console.log(e)}))}function ce(e){X.deleteLike(e).catch((function(e){console.log(e)}))}function ue(e,t){ne.open(e,t)}function se(e,t,n,o,i,a){return new r(e,t,n,ue,le,ae,ce,o,i,a).initCard()}function le(e){$.open();var t=e.closest(".element").id;K.addEventListener("click",(function(){I(K),X.deleteCard(t).then((function(e){ie.deleteItem(document.getElementById(t)),$.close()})).catch((function(e){console.log(e)})).finally((function(){I(K)}))}))}Promise.all([X.getCard(),X.getInfo()]).then((function(e){ie.renderItems(e[0],e[1].name,e[1]._id);var t={};t.name=e[1].name,t.subtitle=e[1].about,t.avatar=e[1].avatar,oe.setUserInfo(t),oe.setAvatar(t.avatar)})).catch((function(e){console.log(e)})),O.addEventListener("click",(function(){var e=oe.getUserInfo();M.value=e.name,G.value=e.prof,Y.hideAllInputsError(),Y.toggleClassSubmitButton(!0),ee.open()})),B.addEventListener("click",(function(){Z.hideAllInputsError(),te.open()})),Q.addEventListener("click",(function(){re.open()}))})();